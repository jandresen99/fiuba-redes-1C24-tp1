from socket import *
from argparse import ArgumentParser

SERVER_IP = "127.0.0.1"
SERVER_PORT = 6000

# TODO: crear función build_menu que reciba por parámetro "upload", "download" o "server"
# y te arme el menú
def build_menu():
    parser = ArgumentParser(description='Downloads a from the server')
    
    group = parser.add_mutually_exclusive_group()
    group.add_argument('-v', '--verbose', action='store_true', help='increase output verbosity')
    group.add_argument('-q', '--quiet', action='store_true', help='decrease output verbosity')

    parser.add_argument('-H', '--host', default=SERVER_IP, help='server IP address. Defaults to 127.0.0.1', metavar='ADDR')
    parser.add_argument('-p', '--port', type=int, default=SERVER_PORT, help='server port. Defaults to port 6000', metavar='PORT')
    parser.add_argument('-d', '--src', help='destination file path', metavar='FILEPATH', required=True)
    parser.add_argument('-n', '--name', help='file name', metavar='FILENAME', required=True)
    
    return parser.parse_args()
    
def download_file(host, port, file_name):
    message = f"Requesting file {file_name}"
    
    clientSocket = socket(AF_INET, SOCK_DGRAM)
    clientSocket.sendto(message.encode(), (host, port))
    print(f"Message sent: {message}")
    
    data, serverAddr = clientSocket.recvfrom(1024)
    print(f"Response received: {data.decode()}")
    
def main():
    args = build_menu()
    download_file(args.host, args.port, args.name)
    
if __name__ == "__main__":
    main()

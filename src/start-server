import logging

from lib.utils import get_server_args
from lib.server import Server

logger = logging.getLogger(__name__)
            
def set_logger(args):
    if args.verbose:
        level = logging.DEBUG
    elif args.quiet:
        level = logging.WARNING
    else:
        level = logging.INFO

    logging.basicConfig(filename='server.log', level=level)
    ch = logging.StreamHandler()
    ch.setLevel(level)
    logger.addHandler(ch)

def main():
    try:
        args = get_server_args()
        set_logger(args)
        server = Server(args.host, args.port, logger)
        server.start()
        
    except KeyboardInterrupt:
        print('\nClosing server...')
        server.stop()


if __name__ == "__main__":
    main()
